# Test duckrow sync --dry-run shows plan without making changes

# Create skill repo
mkdir skill-source
cp skill-md skill-source/SKILL.md
setup-git-repo skill-source test-skills test-skill

# Set up config override
setup-config-override test-owner/test-repo skill-source

# Create project and install a skill (creates lock file)
mkdir myproject
exec duckrow skill install https://github.com/test-owner/test-repo -d myproject
stdout 'Installed: test-skill'
exists myproject/duckrow.lock.json

# Dry run with skill present should show skip
exec duckrow sync -d myproject --dry-run
stdout 'skip: test-skill \(already installed\)'
stdout 'Skills: 0 installed, 1 skipped, 0 errors'

# Delete the skill directory
exec rm -rf myproject/.agents/skills/test-skill

# Dry run should show install plan
exec duckrow sync -d myproject --dry-run
stdout 'install: test-skill \(commit'
stdout 'Skills: 1 installed, 0 skipped, 0 errors'

# Verify skill was NOT actually installed (dry run)
dir-not-exists myproject/.agents/skills/test-skill

-- skill-md --
---
name: test-skill
description: A skill for testing
---
# Test Skill

This is a test skill.
