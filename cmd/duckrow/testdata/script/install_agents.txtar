# Test --agents flag controls which agents receive symlinks

# Create a project directory
mkdir myproject

# Create skill files and turn into a git repo
mkdir skill-source
cp skill-md skill-source/SKILL.md
setup-git-repo skill-source test-skills agent-test

# Set up config override to redirect test-owner/test-repo to local git repo
setup-config-override test-owner/test-repo skill-source

# Install with --agents=cursor (only create cursor symlink)
exec duckrow skill install https://github.com/test-owner/test-repo -d myproject --agents=cursor
stdout 'Installed: agent-test'
stdout 'Cursor'
exists myproject/.agents/skills/agent-test/SKILL.md
exists myproject/.cursor/skills/agent-test
is-symlink myproject/.cursor/skills/agent-test

# No claude dir should be created
dir-not-exists myproject/.claude/skills

# Clean up
exec duckrow skill uninstall agent-test -d myproject
dir-not-exists myproject/.agents/skills/agent-test
dir-not-exists myproject/.cursor/skills/agent-test

# Install with multiple --agents (cursor,claude-code)
exec duckrow skill install https://github.com/test-owner/test-repo -d myproject --agents=cursor,claude-code
stdout 'Installed: agent-test'
exists myproject/.agents/skills/agent-test/SKILL.md
exists myproject/.cursor/skills/agent-test
is-symlink myproject/.cursor/skills/agent-test
exists myproject/.claude/skills/agent-test
is-symlink myproject/.claude/skills/agent-test

# No windsurf dir should be created
dir-not-exists myproject/.windsurf/skills

# Clean up
exec duckrow skill uninstall agent-test -d myproject
dir-not-exists myproject/.agents/skills/agent-test
dir-not-exists myproject/.cursor/skills/agent-test
dir-not-exists myproject/.claude/skills/agent-test

# Install with default (no --agents flag, non-interactive = universal only)
exec duckrow skill install https://github.com/test-owner/test-repo -d myproject
stdout 'Installed: agent-test'
exists myproject/.agents/skills/agent-test/SKILL.md
dir-not-exists myproject/.cursor/skills
dir-not-exists myproject/.claude/skills

# Clean up
exec duckrow skill uninstall agent-test -d myproject

# Install with invalid agent name should fail
! exec duckrow skill install https://github.com/test-owner/test-repo -d myproject --agents=nonexistent
stderr 'unknown agent "nonexistent"'

-- skill-md --
---
name: agent-test
description: A skill for testing agent selection
metadata:
  version: "1.0.0"
---
# Agent Test Skill
