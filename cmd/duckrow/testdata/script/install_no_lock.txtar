# Test that --no-lock flag skips lock file creation

# Create a project directory
mkdir myproject

# Create skill files and turn into a git repo
mkdir skill-source
cp skill-md skill-source/SKILL.md
setup-git-repo skill-source test-skills test-skill

# Set up config override
setup-config-override test-owner/test-repo skill-source

# Install with --no-lock
exec duckrow skill install https://github.com/test-owner/test-repo -d myproject --no-lock
stdout 'Installed: test-skill'
! stderr .

# Verify skill was installed
exists myproject/.agents/skills/test-skill/SKILL.md

# Verify lock file was NOT created
! exists myproject/duckrow.lock.json

# Now install without --no-lock to create the lock file
mkdir skill-source-b
cp skill-md-b skill-source-b/SKILL.md
setup-git-repo skill-source-b test-skills-b other-skill

setup-registry-config test-owner/test-repo-b skill-source-b

exec duckrow skill install https://github.com/test-owner/test-repo-b -d myproject
stdout 'Installed: other-skill'
exists myproject/duckrow.lock.json
file-contains myproject/duckrow.lock.json '"name": "other-skill"'

# Uninstall with --no-lock should not touch the lock file
exec duckrow skill uninstall other-skill -d myproject --no-lock
stdout 'Removed: other-skill'
# Lock file should still contain the entry (--no-lock skipped removal)
file-contains myproject/duckrow.lock.json '"name": "other-skill"'

-- skill-md --
---
name: test-skill
description: A skill for testing
---
# Test Skill
-- skill-md-b --
---
name: other-skill
description: Another skill for testing
---
# Other Skill
