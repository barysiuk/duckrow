# Test uninstalling all skills

# Create two skill repos as git repos
mkdir source-a
cp alpha-md source-a/SKILL.md
setup-git-repo source-a test-skills-a alpha

mkdir source-b
cp beta-md source-b/SKILL.md
setup-git-repo source-b test-skills-b beta

# Set up config overrides for both repos
setup-config-override test-owner/source-a source-a
setup-registry-config test-owner/source-b source-b

# Setup: create project and install multiple skills
mkdir myproject
exec duckrow skill install https://github.com/test-owner/source-a -d myproject
exec duckrow skill install https://github.com/test-owner/source-b -d myproject
exists myproject/.agents/skills/alpha/SKILL.md
exists myproject/.agents/skills/beta/SKILL.md

# Also install an agent so we can verify it survives skill uninstall --all
setup-agent-repo agent-source 'my-agent:A helpful agent'
setup-config-override test-owner/agent-source agent-source
exec duckrow agent install https://github.com/test-owner/agent-source -d myproject
file-contains myproject/duckrow.lock.json '"kind": "agent"'
file-contains myproject/duckrow.lock.json '"kind": "skill"'

# Uninstall all skills
exec duckrow skill uninstall --all -d myproject
stdout 'Removed: alpha'
stdout 'Removed: beta'
stdout 'Removed 2 skill'

# Verify all skills gone
dir-not-exists myproject/.agents/skills/alpha
dir-not-exists myproject/.agents/skills/beta

# Verify agent lock entry survived (not wiped by skill uninstall --all)
file-contains myproject/duckrow.lock.json '"kind": "agent"'
file-contains myproject/duckrow.lock.json '"name": "my-agent"'
! file-contains myproject/duckrow.lock.json '"kind": "skill"'

# Uninstall --all on empty project
exec duckrow skill uninstall --all -d myproject
stdout 'No skills installed'

-- alpha-md --
---
name: alpha
description: Alpha skill
---
# Alpha
-- beta-md --
---
name: beta
description: Beta skill
---
# Beta
